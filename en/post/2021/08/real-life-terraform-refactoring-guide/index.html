<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.3.0 for Hugo"><meta name=author content="Matheus Cunha"><meta name=description content="Want to know how to better organize existing Terraform code? If
you grasp these ideas, it could even serve for not-yet Infrastructure as Code
resources. Jump in and take a look.
"><link rel=alternate hreflang=en-us href=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/><meta name=theme-color content="#1565c0"><link rel=stylesheet href=https://macunha.me/css/vendor-bundle.min.1e75974c6945afa9e52fa8182894548d.css media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/monokai.min.css crossorigin=anonymous title=hl-light media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/monokai.min.css crossorigin=anonymous title=hl-dark media=print onload="this.media='all'" disabled><link rel=stylesheet href=https://macunha.me/css/wowchemy.bcde3c18a267ad29e769cbf0bb31caf6.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143794949-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(a,b){gtag('event','click',{event_category:'outbound',event_label:a,transport_type:'beacon',event_callback:function(){b!=='_blank'&&(document.location=a)}}),console.debug("Outbound link clicked: "+a)}function onClickCallback(a){if(a.target.tagName!=='A'||a.target.host===window.location.host)return;trackOutboundLink(a.target,a.target.getAttribute('target'))}gtag('js',new Date),gtag('config','UA-143794949-1',{anonymize_ip:!0}),gtag('set',{cookie_flags:'SameSite=None;Secure'}),document.addEventListener('click',onClickCallback,!1)</script><link rel=manifest href=https://macunha.me/en/index.webmanifest><link rel=icon type=image/png href=https://macunha.me/media/icon_hu176de0364afaeda8922c372b574c3cbf_6946_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=https://macunha.me/media/icon_hu176de0364afaeda8922c372b574c3cbf_6946_180x180_fill_lanczos_center_2.png><link rel=canonical href=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="It's me, Macunha!"><meta property="og:url" content="https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/"><meta property="og:title" content="Real-life Terraform Refactoring Guide | It's me, Macunha!"><meta property="og:description" content="Want to know how to better organize existing Terraform code? If
you grasp these ideas, it could even serve for not-yet Infrastructure as Code
resources. Jump in and take a look.
"><meta property="og:image" content="https://macunha.me/media/icon_hu176de0364afaeda8922c372b574c3cbf_6946_512x512_fill_lanczos_center_2.png"><meta property="twitter:image" content="https://macunha.me/media/icon_hu176de0364afaeda8922c372b574c3cbf_6946_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2021-08-11T00:00:00+02:00"><meta property="article:modified_time" content="2021-09-03T08:33:38+02:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/"},"headline":"Real-life Terraform Refactoring Guide","datePublished":"2021-08-11T00:00:00+02:00","dateModified":"2021-09-03T08:33:38+02:00","author":{"@type":"Person","name":"Matheus Cunha"},"publisher":{"@type":"Organization","name":"It's me, Macunha!","logo":{"@type":"ImageObject","url":"https://macunha.me/media/icon_hu176de0364afaeda8922c372b574c3cbf_6946_192x192_fill_lanczos_center_2.png"}},"description":"Want to know how to better organize existing Terraform code? If\nyou grasp these ideas, it could even serve for not-yet Infrastructure as Code\nresources. Jump in and take a look.\n"}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#1565c0",text:"rgb(255, 255, 255)"},button:{background:"rgb(255, 255, 255)",text:"#1565c0"}},theme:"classic",content:{message:"This website uses cookies to ensure you get the best experience on our website.",dismiss:"Got it!",link:"Learn more",href:"https://www.cookiesandyou.com"}})})</script><title>Real-life Terraform Refactoring Guide | It's me, Macunha!</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=041f783c12aeb7a45d987338fc3f948b><script src=https://macunha.me/js/wowchemy-init.min.8988fb2a4bba758785868cfcb5244555.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class=page-header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=https://macunha.me/en/>It's me, Macunha!</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=https://macunha.me/en/>It's me, Macunha!</a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=https://macunha.me/en/project/><span>Projects</span></a></li><li class=nav-item><a class="nav-link active" href=https://macunha.me/en/post/><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=https://macunha.me/en/author/matheus-cunha/><span>About</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Real-life Terraform Refactoring Guide</h1><div class=article-metadata><span class=article-date>Last updated on
03/09/2021</span>
<span class=middot-divider></span><span class=article-reading-time>7 min read</span>
<span class=middot-divider></span><a href=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/#disqus_thread></a><span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=https://macunha.me/en/category/infrastructure-as-code/>Infrastructure As Code</a>, <a href=https://macunha.me/en/category/terraform/>Terraform</a>, <a href=https://macunha.me/en/category/devops/>DevOps</a></span></div></div><div class=article-container><div class=article-style><h2 id=intro>Intro</h2><p>As reality hits, the unavoidable fact of dealing with a hard-to-manage Terraform
<a href=https://en.wikipedia.org/wiki/Big%5Fball%5Fof%5Fmud target=_blank rel=noopener>Big ball of mud</a> code base comes in. There is no way around natural growth and
evolution of code bases and the design flaws that come with it. Our Agile
mindset is to <a href=https://www.brainyquote.com/quotes/mark%5Fzuckerberg%5F453439 target=_blank rel=noopener>&ldquo;move fast and break things&rdquo;</a>, implement something as simple as
possible and let the design decisions for the next iterations (if any).</p><p>Refactoring Terraform code is actually as natural as developing it, time and
time again you will be faced with a situation where a better structure or
organization can be achieved, maybe you want to upgrade from a home-made module
to an open-source/community alternative, maybe you just want to segregate your
resources into different states to speed-up development. Regardless of the goal,
once you get into it, you will realize that Terraform code refactoring is
actually a basic missing step on the development process that no one told you
before.</p><p>As the <a href=http://nathanmarz.com/blog/suffering-oriented-programming.html target=_blank rel=noopener>Suffering-Oriented Programming</a> mantra dictates:</p><blockquote><p>&ldquo;First make it possible. Then make it beautiful. Then make it fast.&rdquo;</p></blockquote><p>So, time to make the Terraform code beautiful!</p><h2 id=how-to-break-a-big-ball-of-mud-strangle-it>How to break a big ball of mud? STRANGLE IT</h2><p><code>&lt;joke></code> Martin Fowler has already written everything there is to write about
(early 2000s) DevOps, Agile, and Software Development. Therefore, we could
reference Martin Fowler for virtually anything Software related <code>&lt;/joke></code>, but
really, the <a href=https://martinfowler.com/books/refactoring.html target=_blank rel=noopener>Refactoring book</a> is <strong>THE</strong> reference on this subject.</p><p>Martin Fowler shared the <a href=https://martinfowler.com/bliki/StranglerFigApplication.html target=_blank rel=noopener>Stangler (Fig) Pattern</a>, which describes a strategy to
refactor a legacy code base by re-implementing the same features (sometimes even
the bugs) on another application.</p><blockquote><p>[&mldr;] the huge strangler figs. They seed in the upper branches of a tree and
gradually work their way down the tree until they root in the soil. Over many
years they grow into fantastic and beautiful shapes, meanwhile strangling and
killing the tree that was their host.</p><p>This metaphor struck me as a way of describing a way of doing a rewrite of an
important system.</p></blockquote><p>In this document we are going to follow the same idea:</p><ol><li>implement the same feature on a different <a href=https://www.terraform-best-practices.com/key-concepts#composition target=_blank rel=noopener>Terraform composition</a>;</li><li>migrate the Terraform state;</li><li>delete (kill) the previous implementation.</li></ol><h2 id=the-mono-repository--monorepo--approach-to-legacy>The mono-repository (monorepo) approach to Legacy</h2><p>Let&rsquo;s suppose that your Terraform code base is versioned in a single repository
(a.k.a. monorepo), following the random structure displayed below (just to help
illustrate)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>.
├── modules/    # Definition of TF modules used by underlying compositions
├── global/     # Resources that aren&#39;t restricted to one environment
│   ├── aws/
├── production/ # Production environment resources
│   └── aws/
└── staging/    # Staging environment resources
    └── aws/
</code></pre></div><p>On this example each directory corresponds to a Terraform state. In order to
apply changes you have to walk to a path and execute <code>terraform</code>.</p><p>The structure on this example repository was created a few hypothetical years
ago when the number of existing microservices and resources (DB, message queues,
etc) was significantly smaller. At the time, it was feasible to keep Terraform
definitions together because it was easier to maintain, Cloud resources were
managed with one-shot!</p><p>As the time went by, the number of Products and the team grew, and engineers
started facing concurrency issues: Terraform lock executions on a shared storage
when someone else is running <code>terraform apply</code> as well as a general slowness on
<strong>every execution</strong> since the number of data sources to sync is frightening.</p><p>A mono-repository approach is not necessarily bad, versioning is actually
simpler when performed in one single repository. Ideally, there won&rsquo;t be many
changes on the scale of GiB meaning that it is safe to proceed on this one <em>as
long as the Terraform remote states are divided</em>.</p><h3 id=splitting-the-modules-sub-path-to-its-own-repository>Splitting the <code>modules</code> sub-path to its own repository</h3><p>One thing to mention though is the <code>modules</code> sub-path, this one could be stored
in a different git repository to leverage its own versioning. Since Terraform
modules and its implementations don&rsquo;t always evolve in the same pace, keeping
two distinct version trees is beneficial. Additionally, a separated repository
for Terraform modules allows the specification of &ldquo;pinned versions&rdquo;, e.g.:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>module <span style=color:#e6db74>&#34;aws_main_vpc&#34;</span> {
  source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;git::https://github.com/terraform-aws-modules/terraform-aws-vpc.git?ref=2ca733d&#34;</span>
  <span style=color:#75715e># Note the ref=${GIT_REVISION_DIGEST}</span>
}
</code></pre></div><p>That reference for a module&rsquo;s version should always be specified, regardless if
it comes from an internal/private repository or public. When you specify the
version, you are ensuring reproducibility.</p><p>Therefore, let&rsquo;s move the <code>modules</code> sub-path to another git repository,
following instructions from <a href=https://stackoverflow.com/questions/359424/detach-move-subdirectory-into-separate-git-repository/17864475#17864475 target=_blank rel=noopener>this StackOverflow answer</a> so that the git commit
history is preserved:</p><h4 id=0-dot>0.</h4><p>Walk to the monorepo path and create a branch from the commits at
<code>monorepo/modules</code> path</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>MAIN_BIGGER_REPO<span style=color:#f92672>=</span>/path/to/the/monorepo
cd <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>MAIN_BIGGER_REPO<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
git subtree split -P modules -b refact-modules
</code></pre></div><h4 id=1-dot>1.</h4><p>Create the new repository</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir /path/to/the/terraform-modules <span style=color:#f92672>&amp;&amp;</span> cd $_
git init
git pull <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>MAIN_BIGGER_REPO<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> refact-modules
</code></pre></div><h4 id=2-dot>2.</h4><p>Link the new repository to your remote Git (server)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git remote add origin &lt;git@git.com:user/terraform-modules.git&gt;
git push -u origin master
</code></pre></div><h4 id=3-dot>3.</h4><p>[OPTIONAL] Cleanup inside <code>$MAIN_BIGGER_REPO</code>, if desired</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd <span style=color:#e6db74>${</span>MAIN_BIGGER_REPO<span style=color:#e6db74>}</span>
git rm -rf modules
git filter-branch --prune-empty <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --tree-filter <span style=color:#e6db74>&#34;rm -rf modules&#34;</span> -f HEAD
</code></pre></div><h3 id=let-s-start-strangling-the-repository>Let&rsquo;s start strangling the repository</h3><p>Now that a substantial piece of code was moved somewhere else, it is time to
put the <a href=https://martinfowler.com/bliki/StranglerFigApplication.html target=_blank rel=noopener>Stangler (Fig) Pattern</a> in practice.</p><p>Move all the existing content as-is to the <code>legacy</code> sub-path, keeping the same
repository and change history (commits). It also allows applying the <code>legacy</code>
code as it used to be from one of those paths.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>.
└── legacy
    ├── global
    │   └── aws
    ├── production
    │   └── aws
    └── staging
        └── aws
</code></pre></div><p>Once the content is moved to legacy, the idea is to follow the <a href=https://www.oreilly.com/library/view/97-things-every/9780596809515/ch08.html target=_blank rel=noopener>Boy Scout rule</a>
in order to strangle the <code>legacy</code> content little by little (unless you are
really committed to migrating it all at once, which is going to be exhaustive).</p><p>The Boy Scout rule goes like:</p><ol><li>every time a task that involves deprecated code appears, we implement it on
<a href=../stdout/blog/2021/03/terraform-best-practices.org>the new structure</a>;</li><li>import the Terraform state to keep the Cloud resources that a given code
represents/describes;</li><li>remove the state and the code from <code>legacy</code>.</li></ol><p>Until there is nothing left inside <code>legacy</code> (or there are only unused
resources/left-behinds that could be destroyed/garbage collected either way).</p><h4 id=import-state-remove-state-and-code-from-what-where>Import state? Remove state and code from what? Where?</h4><p>That will depend on the kind of resource we are migrating from the remote state,
on the bottom of each <code>resource</code> on Terraform&rsquo;s provider documentation you can
find a reference command to import existing resources into your Terraform code
specification. e.g.: <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db%5Finstance#import target=_blank rel=noopener>AWS RDS DB instance</a>.</p><p>Suppose we want to replace the code of the AWS RDS Aurora defined in
<code>production/aws</code> and then re-implement the same using <a href=https://github.com/terraform-aws-modules/terraform-aws-rds-aurora target=_blank rel=noopener>the community module</a>.
After creating the corresponding sub-path to the monorepo according to your
preference, provisioning the bucket and initializing the Terraform <code>backend</code>:</p><ol><li><p>implement the definition of the community module
<a href=https://github.com/terraform-aws-modules/terraform-aws-rds-aurora target=_blank rel=noopener>github.com/terraform-aws-modules/terraform-aws-rds-aurora</a> with the closest
parameters from the existing one; e.g.:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>module <span style=color:#e6db74>&#34;aws_aurora_main_cluster&#34;</span> {
  source  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;terraform-aws-modules/rds-aurora/aws&#34;</span>
  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;~&gt; 5.2&#34;</span>

  <span style=color:#75715e># ...</span>
}
</code></pre></div></li><li><p>import the Terraform states from the previous (existing) cluster</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>terraform import <span style=color:#e6db74>&#39;aws_aurora_main_cluster.aws_rds_cluster.this[0]&#39;</span> main-database-name
terraform import <span style=color:#e6db74>&#39;aws_aurora_main_cluster.aws_rds_cluster_instance.this[0]&#39;</span> main-database-instance-name-01
terraform import <span style=color:#e6db74>&#39;aws_aurora_main_cluster.aws_rds_cluster_instance.this[1]&#39;</span> main-database-instance-name-02

<span style=color:#75715e># ...</span>
</code></pre></div><p>then if you haven&rsquo;t yet and would like to &ldquo;match reality&rdquo; between the
existing and the specified resource, run <code>terraform plan</code> a few times and
adjust the parameters until Terraform reports:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>No changes. Your infrastructure matches the configuration.
</code></pre></div></li><li><p>last but not least, remove the corresponding resources from the <code>legacy</code>
Terraform state so that it doesn&rsquo;t try to keep track of the changes and also
don&rsquo;t try to destroy once the resource definition is no longer in that code
base:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Hypothetical name of the resource inside production/aws/main.tf</span>
terraform state rm aws_rds_cluster.default <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    <span style=color:#e6db74>&#39;aws_rds_cluster_instance.default[0]&#39;</span> <span style=color:#e6db74>&#39;aws_rds_cluster_instance.default[1]&#39;</span>

<span style=color:#75715e># ...</span>
</code></pre></div><p>once that is performed, feel free to remove the corresponding resource&rsquo;s
definition from the <code>legacy</code> code.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>resource <span style=color:#e6db74>&#34;aws_rds_cluster&#34;</span> <span style=color:#e6db74>&#34;default&#34;</span> {
  <span style=color:#75715e># ...</span>
}

resource <span style=color:#e6db74>&#34;aws_rds_cluster_instance&#34;</span> <span style=color:#e6db74>&#34;default&#34;</span> {
  count <span style=color:#f92672>=</span> var<span style=color:#f92672>.</span>number_of_database_instances

  <span style=color:#75715e># ...</span>
}
</code></pre></div></li></ol></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/&text=Real-life%20Terraform%20Refactoring%20Guide" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/&t=Real-life%20Terraform%20Refactoring%20Guide" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Real-life%20Terraform%20Refactoring%20Guide&body=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/&title=Real-life%20Terraform%20Refactoring%20Guide" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Real-life%20Terraform%20Refactoring%20Guide%20https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https://macunha.me/en/post/2021/08/real-life-terraform-refactoring-guide/&title=Real-life%20Terraform%20Refactoring%20Guide" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://macunha.me><img class="avatar mr-3 avatar-circle" src=https://macunha.me/en/author/matheus-cunha/avatar_hu538abb559021e5e818cc3fcb6b905317_34815_270x270_fill_q90_lanczos_center.jpg alt="Matheus Cunha"></a><div class=media-body><h5 class=card-title><a href=https://macunha.me>Matheus Cunha</a></h5><h6 class=card-subtitle>Systems Engineer and Magician</h6><p class=card-text>Just a technology lover empowering business with high-tech computing to help innovation (:</p><ul class=network-icon aria-hidden=true><li><a href=https://github.com/macunha1/ target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://gitlab.com/macunha/ target=_blank rel=noopener><i class="fab fa-gitlab"></i></a></li><li><a href=https://www.linkedin.com/in/macunha/ target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a href=https://medium.com/@macunha1 target=_blank rel=noopener><i class="fab fa-medium"></i></a></li></ul></div></div><section id=comments><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='https://macunha1-me.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href=https://macunha.me/en/post/2021/06/terraform-atomic-design/>Terraform: Atomic Design</a></li><li><a href=https://macunha.me/en/post/2021/03/terraform-design-best-practices/>Terraform Design Best Practices</a></li></ul></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class=powered-by>© 2021 Matheus Cunha</p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with Wowchemy — the free, open source website builder that empowers creators.</p></footer></div></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=https://macunha.me/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script id=search-hit-fuse-template type=text/x-template>
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script id=dsq-count-scr src=https://macunha1-me.disqus.com/count.js async></script><script src=https://macunha.me/en/js/wowchemy.min.1eea1e49ea567f29620cae2b6b980427.js></script></body></html>